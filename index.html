<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK Placement Test - Aloha School</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="assets/css/test-pages.css">
</head>
<body>
    <div class="container main-page" id="mainPage">
        <header>
            <div class="logo">
                <img src="assets/images/logoaloha-Photoroom.png" alt="Aloha School Logo">
            </div>
            <button class="support-btn" id="supportBtn">
                H·ªó tr·ª£ kh·∫©n c·∫•p
                <div class="support-popup" id="supportPopup">
                    <div class="support-popup-title">H·ªó tr·ª£ kh·∫©n c·∫•p</div>
                    
                    <div class="support-item">
                        <a href="https://zalo.me/1158613476135726965" target="_blank">
                            <div class="support-item-icon">üí¨</div>
                            <div class="support-item-text">
                                <span class="support-item-label">Zalo OA</span>
                                <span class="support-item-value">Aloha School</span>
                            </div>
                        </a>
                    </div>
                    
                    <div class="support-item">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="support-item-icon">üìû</div>
                            <div class="support-item-text">
                                <span class="support-item-label">Hotline</span>
                                <span class="support-item-value">02486857468</span>
                            </div>
                        </div>
                    </div>
                </div>
            </button>
        </header>

        <div class="hero-banner">
            <h1 class="hero-title">
                <span class="easy">B√†i thi ƒë√°nh gi√° ƒë·∫ßu v√†o</span><br>
                <span class="placement"> ti·∫øng trung HSK </span>
            </h1>
        </div>

        <div class="main-content">
            <div class="decorative-lights"></div>

            <div class="info-section">
                <div class="info-icon">üìù</div>
                <div class="info-text">
                    <p>B√†i thi ƒê√°nh gi√° nƒÉng l·ª±c Ti·∫øng Trung gi√∫p<strong> Aloha</strong> v√† H·ªçc vi√™n c√≥ th·ªÉ ƒë√°nh gi√° ƒë∆∞·ª£c nƒÉng l·ª±c ƒë·∫ßu v√†o tr∆∞·ªõc khi l·ª±a ch·ªçn L·ªõp ph√π h·ª£p t·∫°i <strong>Aloha</strong> HSK.</p>
                    
                    <ul class="info-list">
                        <li><strong>B√†i thi </strong> B√†i thi g·ªìm 3 k·ªπ nƒÉng: Nghe - ƒê·ªçc - Vi·∫øt v·ªõi s·ªë l∆∞·ª£ng c√¢u h·ªèi t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng Level. </li>
                        <li>Sau khi l√†m xong, H·ªçc vi√™n s·∫Ω nh·∫≠n ƒë∆∞·ª£c K·∫øt qu·∫£ k√®m L·ªô tr√¨nh h·ªçc ph√π h·ª£p t·ª´ BP. Chuy√™n m√¥n v√† T∆∞ v·∫•n tuy·ªÉn sinh.</li>
                        <li>M·ªçi th·∫Øc m·∫Øc li√™n h·ªá Hotline: <strong>02486857468</strong>  ho·∫∑c ZaloOA: <strong>Aloha School</strong> ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£.</li>
                    </ul>
                </div>
            </div>

            <div class="form-section">
                <h2 class="form-title">Nh·∫≠p th√¥ng tin ƒë·ªÉ b·∫Øt ƒë·∫ßu b√†i ki·ªÉm tra</h2>
                
                <form id="placementForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>* H·ªç v√† t√™n: (V√≠ d·ª•: Nguy·ªÖn VƒÉn An)</label>
                            <input type="text" name="fullname" id="fullname" required placeholder="Nh·∫≠p h·ªç v√† t√™n ƒë·∫ßy ƒë·ªß">
                            <span class="check-icon" id="fullnameCheck">‚úì</span>
                            <div class="error-message" id="fullnameError">Vui l√≤ng nh·∫≠p h·ªç v√† t√™n ƒë·∫ßy ƒë·ªß</div>
                        </div>
                        <div class="form-group">
                            <label>Tu·ªïi (kh√¥ng b·∫Øt bu·ªôc)</label>
                            <input type="number" name="age" id="age" placeholder="Nh·∫≠p tu·ªïi c·ªßa b·∫°n" min="1" max="120">
                            <span class="check-icon" id="ageCheck">‚úì</span>
                            <div class="error-message" id="ageError">Tu·ªïi ph·∫£i t·ª´ 1 ƒë·∫øn 120</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>* S·ªë ƒëi·ªán tho·∫°i</label>
                            <input type="tel" name="phone" id="phone" required placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                            <span class="check-icon" id="phoneCheck">‚úì</span>
                            <div class="error-message" id="phoneError">S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10-11 ch·ªØ s·ªë</div>
                        </div>
                        <div class="form-group">
                            <label>* Email</label>
                            <input type="email" name="email" id="email" required placeholder="Nh·∫≠p email c·ªßa b·∫°n">
                            <span class="check-icon" id="emailCheck">‚úì</span>
                            <div class="error-message" id="emailError">Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng (v√≠ d·ª•: example@email.com)</div>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn">ƒêI T·ªöI B√ÄI THI</button>
                </form>
            </div>

            <div class="illustration">
                <svg viewBox="0 0 200 250" xmlns="http://www.w3.org/2000/svg">
                    <ellipse cx="100" cy="200" rx="60" ry="20" fill="#7cb342" opacity="0.3"/>
                    <circle cx="100" cy="100" r="40" fill="#fdd5b1"/>
                    <circle cx="85" cy="100" r="3" fill="#333"/>
                    <circle cx="115" cy="100" r="3" fill="#333"/>
                    <path d="M 85 115 Q 100 125 115 115" stroke="#333" stroke-width="2" fill="none"/>
                    <path d="M 60 70 Q 100 50 140 70" fill="#2c2c2c"/>
                    <rect x="70" y="140" width="60" height="60" rx="10" fill="#7cb342"/>
                </svg>
            </div>
        </div>

        <div class="modal-overlay" id="modalOverlay">
            <div class="modal-content">
                <button class="modal-close" id="modalClose">√ó</button>
                
                <div class="modal-illustration">
                    <img src="assets/images/logoaloha-Photoroom.png" alt="Aloha Logo" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                </div>

                <div class="modal-text">
                    <p>Ch√∫ng t√¥i s·∫Ω th√¥ng b√°o k·∫øt qu·∫£ ki·ªÉm tra nƒÉng l·ª±c qua SDT v√† Email.</p>
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn <span class="modal-phone" id="modalPhone">0987654321</span> l√† s·ªë c·ªßa b·∫°n</p>
                </div>

                <div class="modal-buttons">
                    <button class="modal-btn secondary" id="btnChangePhone">S·ªë c·ªßa t√¥i l√† s·ªë kh√°c</button>
                    <button class="modal-btn primary" id="btnConfirm">X√°c nh·∫≠n</button>
                </div>
            </div>
        </div>
    </div>

    <div class="instructions-page" id="instructionsPage">
        <div class="instructions-container">
            <div class="instructions-header">
                <div class="instructions-logo">Aloha</div>
                
                <div class="instructions-banner">
                    <div class="banner-title">PLACEMENT</div>
                    <div class="banner-subtitle">TEST</div>
                </div>
            </div>

            <div class="instructions-content">
                <h2 class="instructions-title">H∆∞·ªõng d·∫´n l√†m b√†i</h2>

                <div class="instruction-item">
                    <div class="instruction-icon">üå±</div>
                    <div class="instruction-text">
                        B√†i test g·ªìm <strong>3 ph·∫ßn</strong> trong th·ªùi gian <strong>20 ph√∫t</strong>:
                        <br>‚Ä¢ <strong>Ph·∫ßn 1 - Nghe:</strong> 5 c√¢u (1 file audio, ch·ªâ nghe 2 l·∫ßn)
                        <br>‚Ä¢ <strong>Ph·∫ßn 2 - ƒê·ªçc hi·ªÉu:</strong> 5 c√¢u (1 ƒëo·∫°n vƒÉn)
                        <br>‚Ä¢ <strong>Ph·∫ßn 3 - Vi·∫øt:</strong> 1 b√†i t·ª± lu·∫≠n
                    </div>
                </div>

                <div class="instruction-item">
                    <div class="instruction-icon">üéß</div>
                    <div class="instruction-text">
                        <strong>Ph·∫ßn Nghe:</strong> File audio ch·ªâ ƒë∆∞·ª£c ph√°t <strong>T·ªêI ƒêA 2 L·∫¶N</strong>. H√£y t·∫≠p trung l·∫Øng nghe!
                    </div>
                </div>

                <div class="instruction-item">
                    <div class="instruction-icon">üìñ</div>
                    <div class="instruction-text">
                        <strong>Ph·∫ßn ƒê·ªçc:</strong> ƒê·ªçc k·ªπ ƒëo·∫°n vƒÉn tr∆∞·ªõc khi tr·∫£ l·ªùi c√¢u h·ªèi.
                    </div>
                </div>

                <div class="instruction-item">
                    <div class="instruction-icon">‚úçÔ∏è</div>
                    <div class="instruction-text">
                        <strong>Ph·∫ßn Vi·∫øt:</strong> Vi·∫øt b√†i t·ª± lu·∫≠n theo y√™u c·∫ßu ƒë·ªÅ b√†i.
                    </div>
                </div>

                <div class="instruction-item">
                    <div class="instruction-icon">‚è∏Ô∏è</div>
                    <div class="instruction-text">
                        Sau khi b·∫•m "<strong>N·ªòP B√ÄI</strong>", th√≠ sinh kh√¥ng th·ªÉ l√†m l·∫°i b√†i thi.
                    </div>
                </div>

                <div class="instruction-item">
                    <div class="instruction-icon">üìß</div>
                    <div class="instruction-text">
                        Th√≠ sinh s·∫Ω ƒë∆∞·ª£c nh·∫≠n k·∫øt qu·∫£ thi ngay sau khi ho√†n th√†nh b√†i thi.
                    </div>
                </div>

                <div class="instruction-item">
                    <div class="instruction-icon">‚ñ∂Ô∏è</div>
                    <div class="instruction-text">
                        Ch·ªçn tr√¨nh ƒë·ªô mu·ªën ki·ªÉm tra v√† ·∫•n "<strong>B·∫ÆT ƒê·∫¶U</strong>" ƒë·ªÉ v√†o l√†m b√†i.
                    </div>
                </div>

                <div class="level-selector">
                    <h3 class="level-selector-title">Vui l√≤ng ch·ªçn tr√¨nh ƒë·ªô mu·ªën test</h3>
                    <div class="level-grid">
                        <div class="level-option" data-level="hsk1" data-range="1-11" data-hsk="1" data-table="questions">
                            <div class="level-name">HSK1</div>
                        </div>
                        <div class="level-option" data-level="hsk2" data-hsk="2" data-table="hsk2_questions">
                            <div class="level-name">HSK2</div>
                        </div>
                        <div class="level-option" data-level="hsk3" data-hsk="3" data-table="hsk3_questions">
                            <div class="level-name">HSK3</div>
                        </div>
                        <div class="level-option" data-level="hsk4" data-hsk="4" data-table="hsk4_questions">
                            <div class="level-name">HSK4</div>
                        </div>
                        <div class="level-option" data-level="hsk5" data-hsk="5" data-table="hsk5_questions">
                            <div class="level-name">HSK5</div>
                        </div>
                    </div>
                </div>

                <button class="start-test-btn" id="startTestBtn" disabled>B·∫ÆT ƒê·∫¶U</button>
            </div>
        </div>
    </div>

    <div class="test-page" id="testPage">
        <div class="test-container">
            <div class="test-header">
                <div class="question-progress">
                    <div class="progress-counter" id="questionCounter">Ph·∫ßn 1: Nghe</div>
                    <div class="progress-circles">
                        <div class="progress-row">
                            <div class="circle">1</div>
                            <div class="circle">2</div>
                            <div class="circle">3</div>
                            <div class="circle">4</div>
                            <div class="circle">5</div>
                        </div>
                    </div>
                </div>
                <div class="timer-section">
                    <div class="timer-icon">‚è±Ô∏è</div>
                    <div class="timer-display" id="timerDisplay">20:00</div>
                </div>
            </div>

            <div class="question-card" id="questionsContainer">
                <!-- Questions will be dynamically rendered here -->
            </div>

            <div class="question-nav">
                <button class="nav-button btn-submit" id="btnSubmit" style="display: none;">N·ªòP B√ÄI</button>
                <button class="nav-button btn-next-section" id="btnNextSection">Ti·∫øp theo ‚Üí</button>
            </div>
            <div class="page-info" id="pageInfo">Ph·∫ßn 1/3 - Nghe</div>
        </div>
    </div>

    <!-- Result page has been moved to result.html -->

    <!-- JavaScript Files - NO MODULES -->
    <script>
        console.log('üöÄ Main script loaded - no modules');

        // Global variables
        let userRowId = null;
        let selectedLevel = null;
        let selectedHSK = null;

        // Validation functions
        function validatePhone(phone) {
            const phoneRegex = /^[0-9]{10,11}$/;
            return phoneRegex.test(phone);
        }

        function validateEmail(email) {
            const emailRegex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;
            return emailRegex.test(email);
        }

        function validateName(name) {
            return name.trim().length >= 3;
        }

        function validateAge(age) {
            if (age === '') return true;
            const ageNum = parseInt(age);
            return !isNaN(ageNum) && ageNum >= 1 && ageNum <= 120;
        }

        function validateForm() {
            console.log('üîç Starting form validation...');
            
            const fullname = document.getElementById('fullname').value.trim();
            const ageValue = document.getElementById('age').value.trim();
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;

            console.log('üìù Form values:', { fullname, ageValue, phone, email });

            let isValid = true;
            let errors = [];

            // Validate fullname
            if (!validateName(fullname)) {
                document.getElementById('fullname').classList.add('error');
                isValid = false;
                errors.push('H·ªç v√† t√™n ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±');
            }

            // Validate age (optional)
            if (ageValue !== '' && !validateAge(ageValue)) {
                document.getElementById('age').classList.add('error');
                isValid = false;
                errors.push('Tu·ªïi ph·∫£i t·ª´ 1 ƒë·∫øn 120');
            }

            // Validate phone
            if (!validatePhone(phone)) {
                document.getElementById('phone').classList.add('error');
                isValid = false;
                errors.push('S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10-11 ch·ªØ s·ªë');
            }

            // Validate email
            if (!validateEmail(email)) {
                document.getElementById('email').classList.add('error');
                isValid = false;
                errors.push('Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng');
            }

            console.log('‚úÖ Validation result:', { isValid, errors });

            if (!isValid) {
                alert('Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin ƒë√£ nh·∫≠p:\n' + errors.join('\n'));
            }

            return isValid;
        }

        // Real-time validation setup
        function setupRealTimeValidation() {
            // Fullname validation
            const fullnameInput = document.getElementById('fullname');
            const fullnameError = document.getElementById('fullnameError');
            const fullnameCheck = document.getElementById('fullnameCheck');
            
            if (fullnameInput) {
                fullnameInput.addEventListener('input', function() {
                    const input = this;
                    const value = input.value.trim();
                    
                    if (value.length === 0) {
                        // Ch∆∞a nh·∫≠p - ·∫©n t·∫•t c·∫£
                        input.classList.remove('error', 'valid');
                        if (fullnameError) fullnameError.classList.remove('show');
                        if (fullnameCheck) fullnameCheck.classList.remove('show');
                    } else if (value.length < 3) {
                        // Nh·∫≠p sai - hi·ªÉn th·ªã X ƒë·ªè
                        input.classList.add('error');
                        input.classList.remove('valid');
                        if (fullnameError) fullnameError.classList.add('show');
                        if (fullnameCheck) {
                            fullnameCheck.classList.add('show');
                            fullnameCheck.innerHTML = '‚úï';
                            fullnameCheck.style.background = '#f44336';
                        }
                    } else {
                        // Nh·∫≠p ƒë√∫ng - hi·ªÉn th·ªã tick xanh
                        input.classList.remove('error');
                        input.classList.add('valid');
                        if (fullnameError) fullnameError.classList.remove('show');
                        if (fullnameCheck) {
                            fullnameCheck.classList.add('show');
                            fullnameCheck.innerHTML = '‚úì';
                            fullnameCheck.style.background = '#4caf50';
                        }
                    }
                });
            }

            // Age validation
            const ageInput = document.getElementById('age');
            const ageError = document.getElementById('ageError');
            const ageCheck = document.getElementById('ageCheck');
            
            if (ageInput) {
                ageInput.addEventListener('input', function() {
                    const input = this;
                    const value = input.value.trim();

                    if (value === '') {
                        // Ch∆∞a nh·∫≠p - ·∫©n t·∫•t c·∫£ (age l√† optional)
                        input.classList.remove('error', 'valid');
                        if (ageError) ageError.classList.remove('show');
                        if (ageCheck) ageCheck.classList.remove('show');
                        return;
                    }

                    const age = parseInt(value);
                    if (isNaN(age) || age < 1 || age > 120) {
                        // Nh·∫≠p sai - hi·ªÉn th·ªã X ƒë·ªè
                        input.classList.add('error');
                        input.classList.remove('valid');
                        if (ageError) ageError.classList.add('show');
                        if (ageCheck) {
                            ageCheck.classList.add('show');
                            ageCheck.innerHTML = '‚úï';
                            ageCheck.style.background = '#f44336';
                        }
                    } else {
                        // Nh·∫≠p ƒë√∫ng - hi·ªÉn th·ªã tick xanh
                        input.classList.remove('error');
                        input.classList.add('valid');
                        if (ageError) ageError.classList.remove('show');
                        if (ageCheck) {
                            ageCheck.classList.add('show');
                            ageCheck.innerHTML = '‚úì';
                            ageCheck.style.background = '#4caf50';
                        }
                    }
                });
            }

            // Phone validation
            const phoneInput = document.getElementById('phone');
            const phoneError = document.getElementById('phoneError');
            const phoneCheck = document.getElementById('phoneCheck');
            
            if (phoneInput) {
                phoneInput.addEventListener('input', function() {
                    const input = this;
                    const value = input.value;
                    
                    if (value.length === 0) {
                        // Ch∆∞a nh·∫≠p - ·∫©n t·∫•t c·∫£
                        input.classList.remove('error', 'valid');
                        if (phoneError) phoneError.classList.remove('show');
                        if (phoneCheck) phoneCheck.classList.remove('show');
                    } else if (!validatePhone(value)) {
                        // Nh·∫≠p sai - hi·ªÉn th·ªã X ƒë·ªè
                        input.classList.add('error');
                        input.classList.remove('valid');
                        if (phoneError) phoneError.classList.add('show');
                        if (phoneCheck) {
                            phoneCheck.classList.add('show');
                            phoneCheck.innerHTML = '‚úï';
                            phoneCheck.style.background = '#f44336';
                        }
                    } else {
                        // Nh·∫≠p ƒë√∫ng - hi·ªÉn th·ªã tick xanh
                        input.classList.remove('error');
                        input.classList.add('valid');
                        if (phoneError) phoneError.classList.remove('show');
                        if (phoneCheck) {
                            phoneCheck.classList.add('show');
                            phoneCheck.innerHTML = '‚úì';
                            phoneCheck.style.background = '#4caf50';
                        }
                    }
                });
            }

            // Email validation
            const emailInput = document.getElementById('email');
            const emailError = document.getElementById('emailError');
            const emailCheck = document.getElementById('emailCheck');
            
            if (emailInput) {
                emailInput.addEventListener('input', function() {
                    const input = this;
                    const value = input.value;
                    
                    if (value.length === 0) {
                        // Ch∆∞a nh·∫≠p - ·∫©n t·∫•t c·∫£
                        input.classList.remove('error', 'valid');
                        if (emailError) emailError.classList.remove('show');
                        if (emailCheck) emailCheck.classList.remove('show');
                    } else if (!validateEmail(value)) {
                        // Nh·∫≠p sai - hi·ªÉn th·ªã X ƒë·ªè
                        input.classList.add('error');
                        input.classList.remove('valid');
                        if (emailError) emailError.classList.add('show');
                        if (emailCheck) {
                            emailCheck.classList.add('show');
                            emailCheck.innerHTML = '‚úï';
                            emailCheck.style.background = '#f44336';
                        }
                    } else {
                        // Nh·∫≠p ƒë√∫ng - hi·ªÉn th·ªã tick xanh
                        input.classList.remove('error');
                        input.classList.add('valid');
                        if (emailError) emailError.classList.remove('show');
                        if (emailCheck) {
                            emailCheck.classList.add('show');
                            emailCheck.innerHTML = '‚úì';
                            emailCheck.style.background = '#4caf50';
                        }
                    }
                });
            }
        }

        // Form submit handler
        function setupFormSubmit() {
            const form = document.getElementById('placementForm');
            if (!form) {
                console.error('‚ùå Form not found: placementForm');
                return;
            }
            
            console.log('‚úÖ Form found, setting up submit handler');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('üì§ Form submitted - preventDefault called');

                if (!validateForm()) {
                    console.log('‚ùå Form validation failed - stopping submission');
                    return;
                }
                console.log('‚úÖ Form validation passed');

                const fullname = document.getElementById('fullname').value.trim();
                const ageValue = document.getElementById('age').value.trim();
                const phone = document.getElementById('phone').value;
                const email = document.getElementById('email').value;

                console.log('üìã Form data collected:', { fullname, ageValue, phone, email });

                // Show modal
                const modalPhone = document.getElementById('modalPhone');
                const modalOverlay = document.getElementById('modalOverlay');
                
                console.log('üîç Modal elements found:', { modalPhone: !!modalPhone, modalOverlay: !!modalOverlay });
                
                if (modalPhone) {
                    modalPhone.textContent = phone;
                    console.log('üì± Modal phone updated to:', phone);
                }
                if (modalOverlay) {
                    modalOverlay.classList.add('show');
                    console.log('üì± Modal overlay shown');
                }
            });
        }

        // Modal handlers
        function setupModalHandlers() {
            const modalClose = document.getElementById('modalClose');
            const btnChangePhone = document.getElementById('btnChangePhone');
            const btnConfirm = document.getElementById('btnConfirm');
            
            if (!modalClose || !btnChangePhone || !btnConfirm) {
                console.error('‚ùå Modal elements not found');
                return;
            }
            
            console.log('‚úÖ Modal elements found, setting up handlers');
            
            modalClose.addEventListener('click', function() {
                console.log('‚ùå Modal close clicked');
                const modalOverlay = document.getElementById('modalOverlay');
                if (modalOverlay) modalOverlay.classList.remove('show');
            });

            btnChangePhone.addEventListener('click', function() {
                console.log('üîÑ Change phone clicked');
                const modalOverlay = document.getElementById('modalOverlay');
                const phoneInput = document.getElementById('phone');
                if (modalOverlay) modalOverlay.classList.remove('show');
                if (phoneInput) phoneInput.focus();
            });

            btnConfirm.addEventListener('click', function() {
                console.log('‚úÖ Confirm button clicked - starting save process');
                
                const fullname = document.getElementById('fullname').value.trim();
                const ageValue = document.getElementById('age').value.trim();
                const phone = document.getElementById('phone').value;
                const email = document.getElementById('email').value;
                
                console.log('üíæ Saving user data:', { fullname, ageValue, phone, email });
                
                // Save to localStorage (simulate database save)
                localStorage.setItem('fullname', fullname);
                localStorage.setItem('phone', phone);
                localStorage.setItem('email', email);
                localStorage.setItem('age', ageValue);
                userRowId = Date.now(); // Simulate user ID
                localStorage.setItem('userRowId', userRowId);
                console.log('üíæ Data saved to localStorage, userRowId:', userRowId);

                // Hide modal and show instructions
                const modalOverlay = document.getElementById('modalOverlay');
                const mainPage = document.getElementById('mainPage');
                const instructionsPage = document.getElementById('instructionsPage');
                
                console.log('üîç Page elements found:', { modalOverlay: !!modalOverlay, mainPage: !!mainPage, instructionsPage: !!instructionsPage });
                
                if (modalOverlay) {
                    modalOverlay.classList.remove('show');
                    console.log('üì± Modal overlay hidden');
                }
                
                setTimeout(() => {
                    console.log('üîÑ Switching to level selection...');
                    if (mainPage) {
                        mainPage.classList.add('hide');
                        console.log('üìÑ Main page hidden');
                    }
                    if (instructionsPage) {
                        instructionsPage.classList.add('show');
                        console.log('üìÑ Level selection page shown');
                    }
                }, 100);
            });
        }

        // Level selection
        function setupLevelSelection() {
            const levelOptions = document.querySelectorAll('.level-option');
            const startBtn = document.getElementById('startTestBtn');
            
            console.log('üéØ Level options found:', levelOptions.length);
            
            levelOptions.forEach(option => {
                option.addEventListener('click', function() {
                    console.log('üéØ Level option clicked:', this.dataset.level);
                    
                    // Remove selected from all
                    document.querySelectorAll('.level-option').forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected to this
                    this.classList.add('selected');
                    
                    // Save selected level
                    selectedLevel = this.dataset.level;
                    selectedHSK = this.dataset.hsk;
                    
                    console.log('‚úÖ Selected:', {level: selectedLevel, hsk: selectedHSK});
                    
                    // Enable start button
                    if (startBtn) {
                        startBtn.disabled = false;
                        console.log('üöÄ Start button enabled');
                    }
                });
            });
        }

        // Start test
        function setupStartTest() {
            const startBtn = document.getElementById('startTestBtn');
            if (!startBtn) {
                console.error('‚ùå Start test button not found');
                return;
            }
            
            console.log('‚úÖ Start test button found');
            
            startBtn.addEventListener('click', function() {
                console.log('üöÄ Start test button clicked');
                
                if (!selectedLevel) {
                    alert('Vui l√≤ng ch·ªçn tr√¨nh ƒë·ªô mu·ªën test!');
                    return;
                }

                console.log('üéØ Starting test for level:', selectedLevel);
                
                // Redirect to appropriate HSK page
                const hskPage = `pages/hsk${selectedHSK}.html`;
                console.log('üîÑ Redirecting to:', hskPage);
                window.location.href = hskPage;
            });
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéâ DOM loaded, initializing app...');
            
            try {
                setupRealTimeValidation();
                console.log('‚úÖ Real-time validation setup complete');
            } catch (error) {
                console.error('‚ùå Error setting up real-time validation:', error);
            }
            
            try {
                setupFormSubmit();
                console.log('‚úÖ Form submit setup complete');
            } catch (error) {
                console.error('‚ùå Error setting up form submit:', error);
            }
            
            try {
                setupModalHandlers();
                console.log('‚úÖ Modal handlers setup complete');
            } catch (error) {
                console.error('‚ùå Error setting up modal handlers:', error);
            }
            
            try {
                setupLevelSelection();
                console.log('‚úÖ Level selection setup complete');
            } catch (error) {
                console.error('‚ùå Error setting up level selection:', error);
            }
            
            try {
                setupStartTest();
                console.log('‚úÖ Start test setup complete');
            } catch (error) {
                console.error('‚ùå Error setting up start test:', error);
            }
            
            console.log('üéâ App initialization complete');
        });
    </script>
</body>
</html>
